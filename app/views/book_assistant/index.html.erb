<div style="max-width: 1200px; margin: 0 auto; padding: 20px; font-family: system-ui, -apple-system, sans-serif;">
  <div style="text-align: center; margin-bottom: 40px;">
    <h1 style="color: #1976d2; margin-bottom: 10px;">ğŸ“š Book Recommendation Assistant</h1>
    <p style="color: #666; font-size: 1.1em;">Ask me anything about books!</p>
  </div>

  <div style="display: grid; grid-template-columns: 1fr 300px; gap: 30px;">
    <div>
      <div id="chat-container" style="background: #f5f5f5; border-radius: 8px; padding: 20px; min-height: 500px; display: flex; flex-direction: column;">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
          <h2 style="margin: 0; color: #333;">Chat</h2>
          <%= button_to "Start New Chat", 
              new_chat_book_assistant_index_path,
              method: :post,
              data: { turbo_method: "post" },
              style: "background: #757575; color: white; padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; font-size: 14px;" %>
        </div>
        <div id="messages" style="flex: 1; overflow-y: auto; margin-bottom: 20px;">
          <%= render "initial_greeting" %>
        </div>

        <div data-controller="book-assistant">
          <%= form_with url: query_book_assistant_index_path, 
                        data: { 
                          turbo_method: "post", 
                          turbo_stream: true,
                          action: "turbo:submit-start->book-assistant#submit turbo:submit-end->book-assistant#turboStreamConnect"
                        } do |f| %>
            <div style="display: flex; gap: 10px;">
              <%= f.text_field :message, 
                  placeholder: "Ask about books...",
                  autocomplete: "off",
                  style: "flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 4px; font-size: 16px;",
                  data: { book_assistant_target: "input" } %>
              <%= f.submit "Send", 
                  style: "background: #1976d2; color: white; padding: 12px 24px; border: none; border-radius: 4px; cursor: pointer; font-size: 16px; transition: all 0.2s;",
                  data: { 
                    book_assistant_target: "submit"
                  } %>
            </div>
          <% end %>
        </div>
      </div>
    </div>

    <div>
      <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px;">
        <h3 style="margin-top: 0;">ğŸ“Š Recent Queries</h3>
        <% if @recent_queries.any? %>
          <% @recent_queries.each do |query| %>
            <div style="padding: 10px 0; border-bottom: 1px solid #eee;">
              <div style="font-size: 0.9em; color: #333;">
                <%= truncate(query.query_text, length: 40) %>
              </div>
              <div style="display: flex; justify-content: space-between; margin-top: 5px;">
                <small style="color: #999;"><%= query.created_at.strftime("%H:%M") %></small>
                <small style="color: <%= query.success ? '#4caf50' : '#f44336' %>;">
                  <%= query.success ? 'Success' : 'Failed' %>
                </small>
              </div>
            </div>
          <% end %>
        <% else %>
          <p style="color: #999;">No queries yet.</p>
        <% end %>
      </div>

      <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
        <h3 style="margin-top: 0;">ğŸ” Quick Links</h3>
        <ul style="list-style: none; padding: 0;">
          <li style="margin: 10px 0;">
            <%= link_to "ğŸ“– Browse All Books", admin_books_path, style: "color: #1976d2; text-decoration: none;" %>
          </li>
          <li style="margin: 10px 0;">
            <%= link_to "ğŸ“ˆ Admin Dashboard", admin_dashboard_path, style: "color: #1976d2; text-decoration: none;" %>
          </li>
          <li style="margin: 10px 0;">
            <%= link_to "ğŸ“ View All Queries", admin_book_queries_path, style: "color: #1976d2; text-decoration: none;" %>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div style="text-align: center; margin-top: 40px; color: #999;">
    <p>Powered by OpenAI GPT-4 and Langchain.rb</p>
  </div>
</div>

<script>
  // Auto-scroll to bottom when new messages are added
  document.addEventListener('turbo:before-stream-render', () => {
    setTimeout(() => {
      const messages = document.getElementById('messages');
      if (messages) {
        messages.scrollTop = messages.scrollHeight;
      }
    }, 100);
  });
</script>
