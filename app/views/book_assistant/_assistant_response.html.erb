<div class="message message-user" style="margin-bottom: 20px;">
  <div style="font-weight: bold; margin-bottom: 5px; color: #1976d2;">
    You
  </div>
  <div style="background: white; padding: 15px; border-radius: 8px;">
    <%= simple_format(message) %>
  </div>
</div>

<div class="message message-assistant" style="margin-bottom: 20px;">
  <div style="font-weight: bold; margin-bottom: 5px; color: #4caf50;">
    Assistant
  </div>
  <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; border: 1px solid #c8e6c9;">
    <% if response[:success] %>
      <% if response[:blocks].present? %>
        <% response[:blocks].each do |block| %>
          <%= render "book_assistant/blocks/#{block['type']}", block: block["content"] %>
        <% end %>
      <% else %>
        <!-- Fallback to simple text -->
        <%= simple_format(response[:message]) %>
      <% end %>
      <% if response[:tools_used].present? %>
        <small style="color: #666; display: block; margin-top: 10px;">
          Tools used: <%= response[:tools_used].join(", ") %>
        </small>
      <% end %>
    <% else %>
      <p style="color: #f44336;"><%= response[:message] %></p>
    <% end %>
  </div>
</div>