<div style="padding: 20px; font-family: system-ui, -apple-system, sans-serif;">
  <div style="margin-bottom: 20px;">
    <%= link_to "← Back to Dashboard", admin_root_path, style: "color: #1976d2; text-decoration: none;" %>
    |
    <%= link_to "Back to Books", admin_books_path, style: "color: #1976d2; text-decoration: none;" %>
  </div>
  
  <h1 style="margin-bottom: 10px;"><%= @book.title %></h1>
  <p style="color: #666; margin-bottom: 20px;">by <%= @book.author %></p>

  <div style="display: grid; grid-template-columns: 1fr 300px; gap: 30px;">
    <div>
      <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px; margin-bottom: 20px;">
        <h3>Book Details</h3>
        <table style="width: 100%;">
          <tr>
            <td style="padding: 10px 0; font-weight: bold; width: 150px;">ISBN:</td>
            <td style="padding: 10px 0;"><%= @book.isbn %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Publisher:</td>
            <td style="padding: 10px 0;"><%= @book.publisher || "N/A" %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Published:</td>
            <td style="padding: 10px 0;"><%= @book.published_at&.strftime("%B %d, %Y") || "N/A" %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Pages:</td>
            <td style="padding: 10px 0;"><%= @book.page_count || "N/A" %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Language:</td>
            <td style="padding: 10px 0;"><%= @book.language.upcase %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Price:</td>
            <td style="padding: 10px 0;">¥<%= @book.price || "N/A" %></td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Availability:</td>
            <td style="padding: 10px 0;">
              <span style="background: <%= @book.availability_status == 'available' ? '#4caf50' : '#ff9800' %>; color: white; padding: 2px 8px; border-radius: 4px;">
                <%= @book.availability_status.capitalize %>
              </span>
            </td>
          </tr>
          <tr>
            <td style="padding: 10px 0; font-weight: bold;">Genres:</td>
            <td style="padding: 10px 0;">
              <% (@book.genres || []).each do |genre| %>
                <span style="background: #e0e0e0; padding: 4px 12px; border-radius: 16px; margin-right: 8px;"><%= genre %></span>
              <% end %>
            </td>
          </tr>
        </table>
        
        <% if @book.description.present? %>
          <h4 style="margin-top: 20px;">Description</h4>
          <p style="line-height: 1.6;"><%= @book.description %></p>
        <% end %>
      </div>

      <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
        <h3>Reviews (<%= @reviews.count %>)</h3>
        <% if @reviews.any? %>
          <% @reviews.each do |review| %>
            <div style="border-bottom: 1px solid #eee; padding: 15px 0;">
              <div style="display: flex; justify-content: space-between; margin-bottom: 8px;">
                <strong><%= review.reviewer_name || "Anonymous" %></strong>
                <span style="color: <%= review.rating >= 4 ? '#4caf50' : '#ff9800' %>;">
                  <%= "★" * review.rating %><%= "☆" * (5 - review.rating) %>
                </span>
              </div>
              <p style="margin: 0; color: #555;"><%= review.content %></p>
              <small style="color: #999;"><%= review.created_at.strftime("%B %d, %Y") %></small>
            </div>
          <% end %>
        <% else %>
          <p style="color: #999;">No reviews yet.</p>
        <% end %>
      </div>
    </div>

    <div>
      <div style="background: #f5f5f5; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
        <h3>Rating</h3>
        <div style="text-align: center;">
          <div style="font-size: 48px; font-weight: bold; color: <%= @book.rating >= 4 ? '#4caf50' : '#ff9800' %>;">
            <%= @book.rating&.round(2) || "N/A" %>
          </div>
          <div style="color: #666;">out of 5</div>
          <div style="margin-top: 10px; color: #999;"><%= @book.review_count %> reviews</div>
        </div>
      </div>

      <% if @book.is_trending %>
        <div style="background: #ffebee; padding: 20px; border-radius: 8px; margin-bottom: 20px;">
          <h3 style="color: #c62828;">🔥 Trending</h3>
          <p>Score: <strong><%= @book.trending_score %></strong></p>
        </div>
      <% end %>

      <div style="background: white; padding: 20px; border: 1px solid #ddd; border-radius: 8px;">
        <h3>Similar Books</h3>
        <% if @similar_books.any? %>
          <% @similar_books.each do |book| %>
            <div style="margin-bottom: 12px;">
              <%= link_to book.title, admin_book_path(book), style: "color: #1976d2; text-decoration: none;" %>
              <div style="font-size: 0.85em; color: #666;"><%= book.author %></div>
            </div>
          <% end %>
          <%= link_to "View all similar →", similar_admin_book_path(@book), style: "color: #388e3c; text-decoration: none; display: block; margin-top: 10px;" %>
        <% else %>
          <p style="color: #999;">No similar books found.</p>
        <% end %>
      </div>
    </div>
  </div>

  <div style="margin-top: 30px;">
    <h3>API Response Preview</h3>
    <pre style="background: #f5f5f5; padding: 15px; border-radius: 4px; overflow-x: auto;"><code><%= JSON.pretty_generate(@book.to_detailed_api_response) %></code></pre>
  </div>
</div>
