<div style="padding: 20px; font-family: system-ui, -apple-system, sans-serif;">
  <%= link_to "← Back to #{@book.title}", admin_book_path(@book), style: "color: #1976d2; text-decoration: none; margin-bottom: 20px; display: inline-block;" %>
  
  <h1>Similar Books to "<%= @book.title %>"</h1>
  <p style="color: #666; margin-bottom: 30px;">Showing books with similarity scores based on genres and author</p>

  <% if @similar_books.any? %>
    <table style="width: 100%; border-collapse: collapse; background: white;">
      <thead>
        <tr style="background: #f5f5f5;">
          <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">Book</th>
          <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">Author</th>
          <th style="padding: 15px; text-align: left; border-bottom: 2px solid #ddd;">Genres</th>
          <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Similarity Score</th>
          <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Rating</th>
          <th style="padding: 15px; text-align: center; border-bottom: 2px solid #ddd;">Actions</th>
        </tr>
      </thead>
      <tbody>
        <% @similar_books.each do |similarity| %>
          <% book = similarity.similar_book %>
          <tr style="border-bottom: 1px solid #eee;">
            <td style="padding: 15px;">
              <strong><%= book.title %></strong>
              <div style="font-size: 0.85em; color: #666;"><%= book.isbn %></div>
            </td>
            <td style="padding: 15px;"><%= book.author %></td>
            <td style="padding: 15px;">
              <% (book.genres || []).each do |genre| %>
                <span style="background: <%= (@book.genres || []).include?(genre) ? '#c8e6c9' : '#e0e0e0' %>; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 4px;">
                  <%= genre %>
                </span>
              <% end %>
            </td>
            <td style="padding: 15px; text-align: center;">
              <div style="display: inline-block; position: relative; width: 100px; height: 20px; background: #e0e0e0; border-radius: 10px;">
                <div style="position: absolute; left: 0; top: 0; height: 100%; background: #4caf50; border-radius: 10px; width: <%= similarity.similarity_score * 100 %>%;"></div>
                <span style="position: relative; z-index: 1; font-weight: bold;"><%= (similarity.similarity_score * 100).round %>%</span>
              </div>
            </td>
            <td style="padding: 15px; text-align: center;">
              <span style="color: <%= book.rating >= 4 ? '#4caf50' : '#ff9800' %>;">
                <%= book.rating&.round(2) || 'N/A' %>
              </span>
            </td>
            <td style="padding: 15px; text-align: center;">
              <%= link_to "View Details", admin_book_path(book), style: "color: #1976d2;" %>
            </td>
          </tr>
        <% end %>
      </tbody>
    </table>

    <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
      <h3>Understanding Similarity Scores</h3>
      <p>Similarity scores are calculated based on:</p>
      <ul>
        <li><strong>Genre overlap:</strong> Books with more genres in common have higher scores</li>
        <li><strong>Author bonus:</strong> Books by the same author receive a +20% bonus</li>
        <li><strong>Range:</strong> Scores range from 0% (no similarity) to 100% (identical genres and author)</li>
      </ul>
    </div>
  <% else %>
    <div style="padding: 40px; text-align: center; background: #f5f5f5; border-radius: 8px;">
      <p style="color: #999; font-size: 1.2em;">No similar books have been calculated yet.</p>
      <p style="color: #666;">Run the rake task to calculate book similarities.</p>
    </div>
  <% end %>
</div>