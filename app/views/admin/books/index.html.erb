<div style="padding: 20px; font-family: system-ui, -apple-system, sans-serif;">
  <div style="margin-bottom: 20px;">
    <%= link_to "← Back to Dashboard", admin_root_path, style: "color: #1976d2; text-decoration: none;" %>
  </div>
  <h1 style="margin-bottom: 20px;">Book Management Dashboard</h1>

  <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;">
    <div style="background: #f0f0f0; padding: 20px; border-radius: 8px;">
      <h3>Statistics</h3>
      <p>Total Books: <strong><%= Book.count %></strong></p>
      <p>Total Reviews: <strong><%= Review.count %></strong></p>
      <p>Avg Rating: <strong><%= Book.average(:rating)&.round(2) || 0 %></strong></p>
    </div>

    <div style="background: #e8f5e9; padding: 20px; border-radius: 8px;">
      <h3>Trending Books</h3>
      <% @trending_books.each do |book| %>
        <div style="margin-bottom: 10px;">
          <%= link_to book.title, admin_book_path(book), style: "color: #2e7d32;" %>
          <span style="color: #666;">(Score: <%= book.trending_score %>)</span>
        </div>
      <% end %>
    </div>

    <div style="background: #e3f2fd; padding: 20px; border-radius: 8px;">
      <h3>Recent Books</h3>
      <% @recent_books.each do |book| %>
        <div style="margin-bottom: 10px;">
          <%= link_to book.title, admin_book_path(book), style: "color: #1976d2;" %>
          <span style="color: #666;">(<%= book.published_at&.strftime("%Y") %>)</span>
        </div>
      <% end %>
    </div>
  </div>

  <div style="margin-bottom: 20px;">
    <h2 style="display: inline-block; margin-right: 20px;">All Books</h2>
    
    <!-- Search Form -->
    <%= form_with url: admin_books_path, method: :get, local: true, style: "display: inline-block;" do |f| %>
      <%= text_field_tag :search, params[:search], placeholder: "Search by title or author...", style: "padding: 8px; width: 300px; border: 1px solid #ddd; border-radius: 4px;" %>
      <%= submit_tag "Search", style: "padding: 8px 16px; background: #2196f3; color: white; border: none; border-radius: 4px; cursor: pointer;" %>
      <% if params[:search].present? %>
        <%= link_to "Clear", admin_books_path, style: "margin-left: 10px; color: #666;" %>
      <% end %>
    <% end %>
    
    <!-- Book Count -->
    <div class="book-count" style="margin-top: 10px; color: #666;">
      Showing <%= @books.offset_value + 1 %>-<%= [@books.offset_value + @books.limit_value, @books.total_count].min %> of <%= @books.total_count %> books
    </div>
  </div>
  <table style="width: 100%; border-collapse: collapse; background: white;">
    <thead>
      <tr style="background: #f5f5f5;">
        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Title</th>
        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Author</th>
        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">ISBN</th>
        <th style="padding: 10px; text-align: left; border-bottom: 2px solid #ddd;">Genres</th>
        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Rating</th>
        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Reviews</th>
        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Trending</th>
        <th style="padding: 10px; text-align: center; border-bottom: 2px solid #ddd;">Actions</th>
      </tr>
    </thead>
    <tbody>
      <% @books.each do |book| %>
        <tr class="book-row" style="border-bottom: 1px solid #eee;">
          <td style="padding: 10px;">
            <%= link_to book.title, admin_book_path(book), style: "color: #333; text-decoration: none; font-weight: 500;" %>
          </td>
          <td style="padding: 10px;"><%= book.author %></td>
          <td style="padding: 10px; font-size: 0.9em; color: #666;"><%= book.isbn %></td>
          <td style="padding: 10px;">
            <% (book.genres || []).each do |genre| %>
              <span style="background: #e0e0e0; padding: 2px 8px; border-radius: 12px; font-size: 0.85em; margin-right: 4px;"><%= genre %></span>
            <% end %>
          </td>
          <td style="padding: 10px; text-align: center;">
            <span style="color: <%= book.rating >= 4 ? '#4caf50' : '#ff9800' %>;">
              <%= book.rating&.round(2) || 'N/A' %>
            </span>
          </td>
          <td style="padding: 10px; text-align: center;"><%= book.reviews.count %></td>
          <td style="padding: 10px; text-align: center;">
            <% if book.is_trending %>
              <span style="color: #f44336;">✓</span>
            <% else %>
              <span style="color: #ccc;">-</span>
            <% end %>
          </td>
          <td style="padding: 10px; text-align: center;">
            <%= link_to "View", admin_book_path(book), style: "color: #1976d2; margin-right: 10px;" %>
            <%= link_to "Similar", similar_admin_book_path(book), style: "color: #388e3c;" %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>
  
  <!-- Pagination -->
  <div style="margin-top: 20px; text-align: center;">
    <nav class="pagination">
      <%= paginate @books, params: { search: params[:search], per_page: params[:per_page] } %>
    </nav>
    
    <!-- Per Page Selector -->
    <div style="margin-top: 10px;">
      Show per page:
      <% [10, 25, 50, 100].each do |per_page| %>
        <%= link_to per_page, admin_books_path(search: params[:search], per_page: per_page), 
            style: "margin: 0 5px; #{'font-weight: bold;' if params[:per_page].to_i == per_page || (params[:per_page].blank? && per_page == 25)}" %>
      <% end %>
    </div>
  </div>

  <div style="margin-top: 30px; padding: 20px; background: #f5f5f5; border-radius: 8px;">
    <h3>Quick Actions</h3>
    <div style="display: flex; gap: 10px;">
      <%= link_to "View Query Logs", admin_book_queries_path, style: "background: #2196f3; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;" %>
      <%= link_to "Generate Sample Data", "#", onclick: "if(confirm('Generate more sample data?')) { fetch('/rails/conductor/action_mailbox/inbound_emails', {method: 'POST'}); } return false;", style: "background: #4caf50; color: white; padding: 10px 20px; text-decoration: none; border-radius: 4px;" %>
    </div>
  </div>
</div>
